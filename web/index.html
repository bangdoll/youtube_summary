<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Brain OS - AI 第二大腦作業系統</title>

    <!-- PWA / Home Screen Icon -->
    <link rel="icon" type="image/png" href="/static/icon.png">
    <link rel="apple-touch-icon" href="/static/icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#050505">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <!-- Login Modal (Google OAuth) -->
    <div id="loginModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2><i class="ri-shield-check-line"></i> 需要登入</h2>
            <p>請使用 Google 帳號登入以使用此服務</p>
            <a href="/auth/login" class="google-login-btn">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="#4285F4"
                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                    <path fill="#34A853"
                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                    <path fill="#FBBC05"
                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                    <path fill="#EA4335"
                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                </svg>
                使用 Google 登入
            </a>
        </div>
    </div>

    <!-- User Info Bar (shown when logged in) -->
    <!-- Top Navigation (Always Visible) -->
    <div id="topNav" class="user-bar">
        <button id="settingsBtn" class="settings-btn" title="設定 API Key" onclick="openSettings()">
            <i class="ri-key-2-line"></i>
            <span>設定 API Key</span>
        </button>
        <div id="userInfo" class="user-info-group hidden">
            <img id="userAvatar" src="" alt="avatar" class="user-avatar">
            <span id="userName"></span>
            <a href="/auth/logout" class="logout-btn"><i class="ri-logout-box-line"></i></a>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay hidden">
        <div class="modal-content settings-content">
            <div class="settings-header">
                <h2><i class="ri-key-2-line"></i> 自訂 API 金鑰</h2>
                <button id="closeSettingsBtn" class="close-btn" onclick="closeSettings()"><i
                        class="ri-close-line"></i></button>
            </div>
            <p class="settings-desc">若您擁有自己的 API Key，請在此設定。系統將優先使用您的金鑰進行分析，這能確保您隨時有足夠的配額。</p>

            <div class="input-group">
                <label><i class="ri-google-fill"></i> Google Gemini API Key</label>
                <input type="password" id="geminiKeyInput" placeholder="AIzaSy...">
                <small>用於影片理解與超長影片分析 (Gemini 3 Flash)</small>
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="api-link">取得 Google API Key <i
                        class="ri-external-link-line"></i></a>
            </div>

            <div class="input-group">
                <label><i class="ri-openai-fill"></i> OpenAI API Key</label>
                <input type="password" id="openaiKeyInput" placeholder="sk-...">
                <small>用於逐字稿分析 (Fallback 模式)</small>
                <a href="https://platform.openai.com/api-keys" target="_blank" class="api-link">取得 OpenAI API Key <i
                        class="ri-external-link-line"></i></a>
            </div>

            <button id="saveSettingsBtn" class="save-btn" onclick="saveSettings()">儲存設定</button>
        </div>
    </div>

    <div class="bg-glow"></div>
    <div class="bg-grid"></div>

    <main class="container">
        <!-- Header -->
        <header>
            <div class="badge">VIBE CODING ENABLED</div>
            <h1>Second Brain <span class="gradient-text">OS</span></h1>
            <p id="appSubtitle" class="subtitle">不僅僅是摘要。這是您的第二大腦作業系統，將雜亂的影音與原本內容轉化為可執行的結構化洞察。</p>
        </header>

        <!-- Landing Page (Shown to Visitors) -->
        <div id="landingSection" class="landing-section hidden">
            <!-- Demo Block -->
            <section class="demo-card">
                <span class="demo-badge">LIVE DEMO</span>
                <div class="demo-terminal-window">
                    <div class="terminal-header">
                        <div class="dots">
                            <span></span><span></span><span></span>
                        </div>
                        <div class="terminal-title">demo@youtube-brain:~</div>
                    </div>
                    <div class="terminal-body demo-body" id="demoTerminalBody">
                        <!-- Typewriter content will appear here -->
                        <div class="cursor-line">
                            <span class="prompt">$</span> <span id="typewriter"></span><span class="cursor">_</span>
                        </div>
                    </div>
                    <div class="demo-overlay">
                        <button id="replayDemoBtn" class="hidden">
                            <i class="ri-refresh-line"></i> Replay
                        </button>
                    </div>
                </div>
            </section>

            <!-- Introduction -->
            <section class="profile-card">
                <img src="/static/avatar.jpg" class="profile-avatar" alt="Developer">
                <div class="profile-content">
                    <h3>關於開發者</h3>
                    <p>我是 蔡正信-數位教練。這款「Second Brain OS」是為了自動化學習流程而打造的 AI Agent，專注於從雜亂的影音中提取結構化的洞察。<br><br>
                        漫遊數位 <a href="https://rd.coach" target="_blank"
                            style="color: var(--accent-secondary); text-decoration: none; font-weight: 600;">https://rd.coach</a>
                    </p>
                </div>
            </section>


        </div>

        <!-- Input Section (Shown to Logged-in Users) -->
        <!-- Input Section -->
        <section id="inputSection" class="input-section hidden">

            <!-- Mode Tabs -->
            <div class="mode-tabs">
                <button class="tab-btn active" onclick="switchTab('youtubeMode')" data-target="youtubeMode">
                    <i class="ri-youtube-fill"></i> 影片智慧分析
                </button>
                <button class="tab-btn" onclick="switchTab('slideMode')" data-target="slideMode">
                    <i class="ri-slideshow-line"></i> 簡報生成器 (Beta)
                </button>
            </div>

            <!-- YouTube Analysis Mode -->
            <div id="youtubeMode" class="mode-content active">
                <div class="input-wrapper">
                    <i class="ri-youtube-fill icon"></i>
                    <input type="text" id="urlInput" placeholder="在此輸入 Youtube 連結，解鎖影片智慧..." autocomplete="off">
                    <button id="submitBtn">
                        <span>開始分析</span>
                        <i class="ri-flashlight-line"></i>
                    </button>
                </div>
            </div>

            <!-- Slide Generator Mode -->
            <div id="slideMode" class="mode-content">
                <!-- Step 1: Upload Area -->
                <!-- Options Row (Above Dropzone) -->
                <div style="display: flex; justify-content: flex-end; margin-bottom: 0.5rem; padding: 0 4px;">
                    <div class="checkbox-wrapper" style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="removeIconCheckbox" checked
                            style="margin-right: 8px; transform: scale(1.1); cursor: pointer;">
                        <label for="removeIconCheckbox"
                            style="cursor: pointer; user-select: none; font-size: 0.9rem; color: #aaa;">移除
                            NotebookLM 圖標</label>
                    </div>
                </div>

                <div class="upload-wrapper" id="dropZone" onclick="triggerUpload()" ondragover="handleDragOver(event)"
                    ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                    <i class="ri-file-ppt-2-line upload-icon"></i>
                    <h3>NotebookLM PDF 轉 PPTX</h3>
                    <p>將 NotebookLM 輸出的 PDF 拖曳至此，或點擊上傳</p>
                    <input type="file" id="pdfInput" accept=".pdf" hidden onchange="handleFileChange(this)">
                    <div id="fileInfo" class="file-info hidden">
                        <span id="fileName">placeholder.pdf</span>
                        <button id="removeFileBtn" class="remove-btn" onclick="removeFile(event)"><i
                                class="ri-close-line"></i></button>
                    </div>
                </div>

                <button id="startPreviewBtn" class="btn-primary hidden" type="button"
                    style="margin-top: 0.5rem; width: 100%; position: relative; z-index: 10;">
                    <span>下一步：解析頁面</span>
                    <i class="ri-arrow-right-line"></i>
                </button>
            </div>

            <!-- Step 2: Preview & Selection (Hidden by default) -->
            <div id="previewStep" class="step-container hidden">
                <div class="preview-header">
                    <div class="header-left">
                        <h3>選擇要轉換的頁面</h3>
                        <span class="count-badge">已選 <strong id="selectedCount">0</strong> / <span
                                id="totalCount">0</span></span>
                    </div>
                    <div class="header-right">
                        <button id="selectAllBtn" class="btn-text" onclick="selectAll()">全選</button>
                        <button id="deselectAllBtn" class="btn-text" onclick="deselectAll()">取消全選</button>
                    </div>
                </div>

                <!-- Grid Container -->
                <div id="pageGrid" class="page-grid">
                    <!-- Grid Items will be injected here -->
                </div>

                <!-- Actions -->
                <div class="preview-actions">
                    <button id="cancelPreviewBtn" class="btn-secondary" onclick="cancelPreview()">
                        <i class="ri-arrow-left-line"></i> 重新上傳
                    </button>
                    <button id="generateSlideBtn" class="generate-btn"
                        onmousedown="generateSlides(this); event.preventDefault();"
                        style="pointer-events: auto !important; position: relative; z-index: 9999;">
                        <span>生成簡報</span>
                        <i class="ri-magic-line"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Web Editor (Hidden by default) -->
            <div id="editorStep" class="step-container hidden">
                <div class="editor-header">
                    <div class="header-left">
                        <button id="backToPreviewBtn" class="btn-text" onclick="backToPreview()">
                            <i class="ri-arrow-left-line"></i> 返回選擇
                        </button>
                        <h3>編輯簡報內容</h3>
                        <span class="count-badge">第 <strong id="currentEditPage">1</strong> / <span
                                id="totalEditPages">0</span> 頁</span>
                    </div>
                    <div class="header-right">
                        <button id="prevSlideBtn" class="btn-secondary" onclick="prevEditSlide()">
                            <i class="ri-arrow-left-s-line"></i> 上一頁
                        </button>
                        <button id="nextSlideBtn" class="btn-secondary" onclick="nextEditSlide()">
                            下一頁 <i class="ri-arrow-right-s-line"></i>
                        </button>
                        <button id="finalGenerateBtn" class="generate-btn" onclick="generatePresentations()">
                            <span>產生 PPTX</span>
                            <i class="ri-download-cloud-2-line"></i>
                        </button>
                    </div>
                </div>

                <div class="editor-workspace">
                    <!-- Left: Clean Image Preview -->
                    <div class="editor-preview">
                        <div class="preview-card">
                            <img id="editorImage" src="" alt="Slide Preview">
                            <span class="badge-overlay">原始版面 (去字)</span>
                        </div>
                    </div>

                    <!-- Right: Content Form -->
                    <div class="editor-form">
                        <div class="form-group">
                            <label><i class="ri-text"></i> page title 標題</label>
                            <textarea id="editTitle" rows="2" placeholder="輸入標題..."></textarea>
                        </div>

                        <div class="form-group">
                            <label><i class="ri-list-check"></i> bullet points 重點內容</label>
                            <textarea id="editContent" rows="10" placeholder="輸入重點 (每行一點)..."></textarea>
                            <small>提示：每一行將會轉為一個條列項目</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading Overlay for Preview -->
            <div id="previewLoading" class="loading-overlay hidden">
                <div class="loader"></div>
                <p>正在讀取 PDF 並產生預覽...</p>
                <p class="sub-text">這通常只需幾秒鐘</p>
            </div>

            <!-- Loading Overlay for Analysis -->
            <div id="analysisLoading" class="loading-overlay hidden">
                <div class="progress-ring-container">
                    <!-- Progress Ring or Bar -->
                    <div class="progress-container">
                        <div class="progress-bar" id="analysisProgressBar" style="width: 0%"></div>
                    </div>
                    <div class="progress-stats">
                        <span id="progressText">準備中...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                </div>
                <p>正在進行 AI 圖文分離與結構化分析...</p>
                <p class="sub-text">這通常需要 2-5 分鐘，視頁數而定</p>
            </div>
            </div>

        </section>

        <!-- Status / Terminal -->
        <section id="statusSection" class="status-section hidden">
            <div class="terminal-header">
                <div class="dots">
                    <span></span><span></span><span></span>
                </div>
                <div class="terminal-title">AI AGENT 執行日誌</div>
            </div>
            <div class="terminal-body" id="terminalOutput">
                <!-- Logs will appear here -->
            </div>
        </section>

        <!-- YouTube Features Grid -->
        <section id="youtubeFeatures" class="features-section">
            <div class="feature-card">
                <div class="feature-icon"><i class="ri-brain-line"></i></div>
                <h3>Gemini 3.0 核心</h3>
                <p>直接理解視訊與聽覺內容，超越傳統逐字稿限制，捕捉細微語氣與脈絡。</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="ri-money-dollar-circle-line"></i></div>
                <h3>智慧成本監控</h3>
                <p>內建 Token 預算警示系統，即時追蹤每一分錢的 API 支出，精準控制預算。</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="ri-lock-2-line"></i></div>
                <h3>企業級安全</h3>
                <p>Google OAuth 驗證搭配 Firebase 雲端加密存儲，保障您的數據隱私。</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="ri-file-list-3-line"></i></div>
                <h3>結構化輸出</h3>
                <p>自動生成 Markdown 筆記，完美整合 Heptabase / Obsidian / Notion。</p>
            </div>
        </section>

        <!-- Slide Generator Features Grid -->
        <section id="slideFeatures" class="features-section hidden">
            <div class="feature-card">
                <div class="feature-icon"><i class="ri-eraser-line"></i></div>
                <h3>AI 圖片文字移除</h3>
                <p>使用 Nano Banana Pro 智慧擦除圖片上的文字，輸出乾淨的視覺元素，真正實現圖文分離。</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="ri-layout-masonry-line"></i></div>
                <h3>OCR 精確定位</h3>
                <p>偵測每個文字的精確邊界框，保留字體大小、粗體、顏色，像素級還原原始版面。</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="ri-file-ppt-2-line"></i></div>
                <h3>完全可編輯 PPTX</h3>
                <p>每個文字區塊都是獨立 Shape，可自由調整位置、字體與顏色，不再是固定圖片。</p>
            </div>
        </section>

        <!-- Comparison Section (YouTube Analysis only) -->
        <section id="youtubeComparison" class="comparison-section">
            <h2 class="section-title">NotebookLM vs. 自建 AI Agent</h2>
            <p class="section-subtitle">為什麼 NotebookLM 那麼快？我們與它有何不同？</p>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <div class="card-header">
                        <i class="ri-speed-mini-line"></i>
                        <h4>速度的秘密 (Privilege)</h4>
                    </div>
                    <div class="card-body">
                        <div class="vs-item negative">
                            <span class="bad">NotebookLM</span>
                            <span class="desc">Google「親兒子」，擁有內部資料直通車。它不需下載影片，直接讀取內部伺服器的逐字稿與資料，因此秒級完成。</span>
                        </div>
                        <div class="vs-item positive">
                            <span class="good">自建 Agent</span>
                            <span class="desc">外部開發者的實力展現。雖然需花時間下載影片進行深度分析，但我們不受限於 Google 的封閉生態，擁有完全的控制權。</span>
                        </div>
                    </div>
                </div>

                <div class="comparison-card">
                    <div class="card-header">
                        <i class="ri-eye-2-line"></i>
                        <h4>閱讀 vs. 觀看 (Modality)</h4>
                    </div>
                    <div class="card-body">
                        <div class="vs-item negative">
                            <span class="bad">NotebookLM</span>
                            <span class="desc">策略是「閱讀」。99% 情況下只讀取逐字稿 (Transcript)，捨棄了畫面細節以換取速度。</span>
                        </div>
                        <div class="vs-item positive">
                            <span class="good">自建 Agent</span>
                            <span class="desc">策略是「全能」。我們支援 Gemini 3 Flash 直接觀看影片
                                (Multimodal)，能理解畫面圖表、表情與非語言訊息，提供更深度的洞察。</span>
                        </div>
                    </div>
                </div>

                <div class="comparison-card">
                    <div class="card-header">
                        <i class="ri-database-2-line"></i>
                        <h4>數據主權 (Sovereignty)</h4>
                    </div>
                    <div class="card-body">
                        <div class="vs-item negative">
                            <span class="bad">NotebookLM</span>
                            <span class="desc">資料留存在 Google 平台，難以自動化導出或串接其他工作流。</span>
                        </div>
                        <div class="vs-item positive">
                            <span class="good">自建 Agent</span>
                            <span class="desc">API-First 設計與 Firebase 存儲。您的筆記是 Markdown 檔案，可直接匯入
                                Obsidian/Heptabase，這是真正屬於您的第二大腦。</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>



        <!-- Result Section -->
        <section id="resultSection" class="result-section hidden">
            <div class="result-header">
                <h2><i class="ri-file-text-line"></i> 智慧分析報告</h2>
                <div class="actions">
                    <button id="copyBtn" class="btn-secondary">
                        <i class="ri-clipboard-line"></i> 複製內容
                    </button>
                    <button id="downloadBtn" class="btn-secondary">
                        <i class="ri-download-line"></i> 下載 Markdown
                    </button>
                </div>
            </div>
            <div class="result-content markdown-body" id="markdownOutput">
                <!-- Markdown content -->
            </div>
        </section>
    </main>

    <script src="/static/script.js?v=2.10.2"></script>
</body>

</html>